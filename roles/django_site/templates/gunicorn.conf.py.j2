# gunicorn settings, see https://docs.gunicorn.org/en/latest/settings.html#logging
wsgi_app = "lick_searchable_archive.wsgi:application"

# Create a pidfile
pidfile="/var/run/gunicorn/gunicorn.pid"

# Number of workers. Currently the front end runs on the same gunicorn server 
# as the backend, so each query request requires 2 workers.
workers=2

# Worker timeout. Set based on the timeout on retries set in dbutils. Note there is still an timeout from "graceful_timeout" default
timeout=65

{% if archive_config == "ops" %}
bind = ['127.0.0.1:{{ api_port }}']
{% else %}
bind = ['0.0.0.0:{{ api_port }}']
{% endif %}

# Logging configuration

{% if archive_config == "ops" %}
loglevel = 'INFO'
{% else %}
loglevel = 'DEBUG'
{% endif %}

accesslog = "{{ archive_log_dir }}/gunicorn_access.log"
errorlog = "{{ archive_log_dir }}/gunicorn_error.log"
capture_output = True


# Hook to print stack trace if a worker aborts.
def worker_abort(worker):
    import traceback
    stack_trace_lines = traceback.format_stack()
    worker.log.error("".join(stack_trace_lines))


{% if remote_watchdog %}
# SSL certs
keyfile="{{ archive_config_dir }}/ssl/private/{{ cert_basename }}_private.pem"
certfile="{{ archive_config_dir }}/ssl/certs/{{ cert_basename }}.cert"
{% endif %}
