# Service configuration for Celery, customized from https://docs.celeryq.dev/en/stable/userguide/daemonizing.html#usage-systemd
[Unit]
Description=Celery Service
After=redis.service
Requires=redis.service

[Service]
Type=forking
User= {{ archive_service_user }}
Group= {{ archive_service_group }}
EnvironmentFile={{ archive_config_dir }}/celery.env
WorkingDirectory={{ package_install_dir }}/lick_searchable_archive/
ExecStart=/bin/sh -c '${CELERY_BIN} -A $CELERY_APP multi start $CELERYD_NODES \
    --pidfile=${CELERYD_PID_FILE} --logfile=${CELERYD_LOG_FILE} \
    --loglevel="${CELERYD_LOG_LEVEL}" $CELERYD_OPTS'
ExecStop=/bin/sh -c '${CELERY_BIN} multi stopwait $CELERYD_NODES \
    --pidfile=${CELERYD_PID_FILE} --logfile=${CELERYD_LOG_FILE} \
    --loglevel="${CELERYD_LOG_LEVEL}"'
ExecReload=/bin/sh -c '${CELERY_BIN} -A $CELERY_APP multi restart $CELERYD_NODES \
    --pidfile=${CELERYD_PID_FILE} --logfile=${CELERYD_LOG_FILE} \
    --loglevel="${CELERYD_LOG_LEVEL}" $CELERYD_OPTS'
Restart=always

[Install]
WantedBy=multi-user.target